╔══════════════════════════════════════════════════════════════╗
║          ОШИБКА 500 ПРИ ГЕНЕРАЦИИ - КАК ИСПРАВИТЬ           ║
╚══════════════════════════════════════════════════════════════╝


═══════════════════════════════════════════════════════════════
❌ ОШИБКА
═══════════════════════════════════════════════════════════════

POST /generate HTTP/1.1" 500 Internal Server Error

Это значит что генерация текста упала с ошибкой.


═══════════════════════════════════════════════════════════════
🔍 ЧТО ДЕЛАТЬ
═══════════════════════════════════════════════════════════════

1. ПЕРЕЗАПУСТИ СЕРВЕР
   ────────────────────────────────────────────────────────────
   
   Обновлён файл server_with_datasets.py
   Добавлен подробный вывод ошибок
   
   Действия:
   • Ctrl+C в окне сервера (остановить)
   • start.bat (запустить снова)


2. ПОПРОБУЙ СГЕНЕРИРОВАТЬ СНОВА
   ────────────────────────────────────────────────────────────
   
   Теперь в окне сервера увидишь ТОЧНУЮ ошибку:
   
   Generation error: <подробное описание>
   Traceback: <где произошло>


3. ПРОВЕРЬ ЧТО МОЖЕТ БЫТЬ НЕ ТАК
   ────────────────────────────────────────────────────────────


═══════════════════════════════════════════════════════════════
🎯 ЧАСТЫЕ ПРИЧИНЫ
═══════════════════════════════════════════════════════════════

ПРИЧИНА 1: Модель не обучена
────────────────────────────────────────────────────────────

Симптомы:
   • Только что создал модель
   • Не запускал обучение
   • Или обучение прервалось сразу

Решение:
   1. Прикрепи датасеты
   2. Запусти обучение
   3. Подожди хотя бы 100-500 итераций
   4. Тогда пробуй генерацию


ПРИЧИНА 2: Токенизатор пустой
────────────────────────────────────────────────────────────

Симптомы:
   • Модель создана
   • Но датасеты не прикреплены
   • Или обучение не было запущено

Решение:
   1. Прикрепи датасеты в вкладке "Датасеты"
   2. Запусти обучение
   3. Тогда генерация заработает


ПРИЧИНА 3: Промпт содержит неизвестные слова
────────────────────────────────────────────────────────────

Симптомы:
   • Модель обучена
   • Но вводишь слова которых нет в датасетах

Решение:
   • Используй слова из твоих датасетов
   • Или дообучи модель на новых данных


ПРИЧИНА 4: GPU закончилась память
────────────────────────────────────────────────────────────

Симптомы:
   • Ошибка: CUDA out of memory

Решение:
   • Уменьши max_length генерации
   • Или закрой другие программы использующие GPU


ПРИЧИНА 5: Файлы модели повреждены
────────────────────────────────────────────────────────────

Симптомы:
   • Модель обучалась
   • Но диск был переполнен
   • Файлы не сохранились полностью

Решение:
   • Запусти cleanup_checkpoints.bat
   • Переобучи модель заново


═══════════════════════════════════════════════════════════════
🛠️ ДИАГНОСТИКА
═══════════════════════════════════════════════════════════════

ШАГ 1: Перезапусти сервер
   Ctrl+C → start.bat

ШАГ 2: Попробуй сгенерировать
   Введи промпт, нажми "Сгенерировать"

ШАГ 3: Смотри в окне сервера
   Там будет точная ошибка, например:
   
   Generation error: Tokenizer not trained
   → Нужно обучить модель
   
   Generation error: CUDA out of memory
   → Закрой другие программы
   
   Generation error: index out of range
   → Промпт содержит неизвестные слова

ШАГ 4: Исправь проблему
   По ошибке поймёшь что делать


═══════════════════════════════════════════════════════════════
✅ ТИПИЧНЫЙ СЦЕНАРИЙ
═══════════════════════════════════════════════════════════════

1. Создал модель "test_model"
2. Не прикрепил датасеты
3. Попробовал сгенерировать
   → ОШИБКА 500!

РЕШЕНИЕ:
   1. Вкладка "Датасеты"
   2. Загрузи .txt файл
   3. Прикрепи к модели
   4. Вкладка "Обучение"
   5. Запусти обучение (хотя бы 500 итераций)
   6. Вкладка "Генерация"
   7. Теперь работает! ✅


═══════════════════════════════════════════════════════════════
🚀 ДЕЙСТВУЙ
═══════════════════════════════════════════════════════════════

1. Перезапусти сервер (Ctrl+C → start.bat)
2. Попробуй генерацию снова
3. Смотри ошибку в окне сервера
4. Напиши мне что за ошибка
5. Исправим!


════════════════════════════════════════════════════════════════

P.S. Теперь все ошибки видны в консоли сервера!
    Это поможет быстро понять что не так.
